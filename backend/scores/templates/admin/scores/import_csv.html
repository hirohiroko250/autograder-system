{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
&rsaquo; <a href="{% url 'admin:app_list' app_label='scores' %}">得点</a>
&rsaquo; <a href="{% url 'admin:scores_score_changelist' %}">得点</a>
&rsaquo; CSVインポート
</div>
{% endblock %}

{% block content %}
<h1>{{ title }}</h1>
<p>{{ subtitle }}</p>

<div class="module aligned">
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        
        <div class="form-row">
            <div>
                <label for="csv_file" class="required">CSVファイル:</label>
                <input type="file" name="csv_file" id="csv_file" accept=".csv" required>
                <p class="help">zyukupageのテンプレート形式のCSVファイルを選択してください。</p>
            </div>
        </div>

        <div class="form-row">
            <h2>対応するCSV形式</h2>
            <table>
                <thead>
                    <tr>
                        <th>列名</th>
                        <th>説明</th>
                        <th>例</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>塾ID</td><td>塾のID</td><td>999999</td></tr>
                    <tr><td>塾名</td><td>塾の名前</td><td>名大SKY</td></tr>
                    <tr><td>教室ID</td><td>教室のID</td><td>999004</td></tr>
                    <tr><td>教室名</td><td>教室の名前</td><td>あま本部</td></tr>
                    <tr><td>生徒ID</td><td>生徒のID（必須）</td><td>201367</td></tr>
                    <tr><td>生徒名</td><td>生徒の名前</td><td>古屋航</td></tr>
                    <tr><td>学年</td><td>学年（小1〜小6、中1〜中3）</td><td>小4</td></tr>
                    <tr><td>年度</td><td>テスト年度</td><td>2025</td></tr>
                    <tr><td>期間</td><td>テスト期間</td><td>夏期</td></tr>
                    <tr><td>出席</td><td>出席状況</td><td>出席</td></tr>
                    <tr><td>国語_大問1〜10</td><td>国語の各大問の得点（最大10問）</td><td>13, 22, 12, 12, ...</td></tr>
                    <tr><td>算数_大問1〜10</td><td>算数の各大問の得点（最大10問）</td><td>14, 10, 34, 10, ...</td></tr>
                </tbody>
            </table>
        </div>

        <div class="submit-row">
            <input type="submit" value="インポート実行" name="apply" class="default">
            <a href="{% url 'admin:scores_score_changelist' %}" class="button cancel-link">キャンセル</a>
        </div>
    </form>
</div>

<div class="module">
    <h2>注意事項</h2>
    <ul>
        <li>CSVファイルは UTF-8 エンコーディングで保存してください</li>
        <li>生徒IDがデータベースに存在しない場合はスキップされます</li>
        <li>対応するテスト定義とクエスチョングループが必要です</li>
        <li>既存の得点データは上書きされます</li>
        <li>エラーがある行は自動的にスキップされ、警告メッセージが表示されます</li>
        <li><strong>大問数は動的に検出されます（最大10問まで対応）</strong></li>
        <li>CSVに存在しない大問番号は自動的にスキップされます</li>
    </ul>
</div>
{% endblock %}