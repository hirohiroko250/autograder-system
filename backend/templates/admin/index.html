{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrastyle %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'admin/css/dashboard.css' %}">
<style>
.admin-dashboard {
  max-width: 1080px;
  margin: 0 auto;
  padding: 2rem 1.5rem 3rem;
  display: flex;
  flex-direction: column;
  gap: 2rem;
}

.dashboard-header {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.dashboard-header h1 {
  margin: 0;
  font-size: 1.75rem;
  font-weight: 600;
  color: var(--color-heading, #1f2937);
}

.dashboard-header p {
  margin: 0;
  color: var(--color-muted, #6b7280);
  font-size: 0.95rem;
}

.dashboard-actions {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 1rem;
}

.quick-link {
  display: flex;
  flex-direction: column;
  gap: 0.35rem;
  padding: 1.25rem;
  background: var(--color-surface, #ffffff);
  border: 1px solid var(--color-border, #e5e7eb);
  border-radius: var(--radius, 10px);
  box-shadow: var(--shadow-sm, 0 1px 2px rgba(15, 23, 42, 0.08));
  text-decoration: none;
  color: inherit;
  transition: transform 0.16s ease, box-shadow 0.16s ease, border-color 0.16s ease;
}

.quick-link strong {
  font-size: 1rem;
  font-weight: 600;
}

.quick-link span {
  color: var(--color-muted, #6b7280);
  font-size: 0.9rem;
}

.quick-link:hover {
  transform: translateY(-2px);
  border-color: var(--color-primary, #2563eb);
  box-shadow: var(--shadow-md, 0 10px 20px -12px rgba(31, 41, 55, 0.35));
}

.dashboard-section h2 {
  margin: 0 0 1rem;
  font-size: 1.125rem;
  font-weight: 600;
  color: var(--color-heading, #1f2937);
}

.dashboard-apps {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 1.25rem;
}

.app-card {
  background: var(--color-surface, #ffffff);
  border: 1px solid var(--color-border, #e5e7eb);
  border-radius: var(--radius, 10px);
  box-shadow: var(--shadow-sm, 0 1px 2px rgba(15, 23, 42, 0.08));
  padding: 1.25rem;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.app-card h3 {
  margin: 0;
  font-size: 1rem;
  font-weight: 600;
  color: var(--color-heading, #1f2937);
}

.model-list {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.model-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 0.75rem;
}

.model-name {
  font-weight: 500;
  color: var(--color-text, #374151);
}

.model-links {
  display: flex;
  gap: 0.5rem;
}

.model-links a {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0.4rem 0.75rem;
  font-size: 0.85rem;
  border-radius: 999px;
  border: 1px solid var(--color-border, #d1d5db);
  color: var(--color-text, #374151);
  text-decoration: none;
  transition: background 0.16s ease, border-color 0.16s ease;
}

.model-links a:hover {
  border-color: var(--color-primary, #2563eb);
  background: rgba(37, 99, 235, 0.08);
  color: var(--color-primary, #2563eb);
}

@media (max-width: 720px) {
  .admin-dashboard {
    padding: 1.5rem 1rem 2.5rem;
  }
  .dashboard-actions {
    grid-template-columns: 1fr;
  }
  .dashboard-apps {
    grid-template-columns: 1fr;
  }
}
</style>
{% endblock %}

{% block breadcrumbs %}{% endblock %}

{% block nav-sidebar %}{% endblock %}

{% block content %}
<div class="admin-dashboard">
  <section class="dashboard-header">
    <h1>管理ダッシュボード</h1>
    <p>よく使う機能へすぐに移動できます。下の一覧から管理したい項目を選択してください。</p>
  </section>

  <section class="dashboard-actions" aria-label="ショートカット">
    <a href="{% url 'csv_import_launcher' %}" class="quick-link">
      <strong>CSV得点インポート</strong>
      <span>テスト結果を一括で登録する</span>
    </a>
    <a href="/admin/students/student/" class="quick-link">
      <strong>生徒管理</strong>
      <span>生徒情報の確認や編集を行う</span>
    </a>
    <a href="/admin/scores/testresult/" class="quick-link">
      <strong>テスト結果</strong>
      <span>得点データを確認する</span>
    </a>
  </section>

  {% if app_list %}
  <section class="dashboard-section" aria-label="管理対象の一覧">
    <h2>管理リスト</h2>
    <div class="dashboard-apps">
      {% for app in app_list %}
      <article class="app-card">
        <h3>{{ app.name }}</h3>
        <ul class="model-list">
          {% for model in app.models %}
          <li class="model-item">
            <span class="model-name">{{ model.name }}</span>
            <span class="model-links">
              {% if model.perms.change or model.perms.view %}
                {% if model.admin_url %}
                  <a href="{{ model.admin_url }}">一覧</a>
                {% endif %}
              {% endif %}
              {% if model.perms.add and model.add_url %}
                <a href="{{ model.add_url }}">追加</a>
              {% endif %}
            </span>
          </li>
          {% empty %}
          <li class="model-item">
            <span class="model-name" style="color: var(--color-muted, #6b7280);">利用可能な項目がありません</span>
          </li>
          {% endfor %}
        </ul>
      </article>
      {% endfor %}
    </div>
  </section>
  {% endif %}
</div>
{% endblock %}
